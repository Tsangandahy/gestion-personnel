<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../style.mot_pass.css">
  <title>PersoManager</title>

  <!-- Font Awesome pour les ic√¥nes -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    /* üîπ Style du bouton Retour (ic√¥ne bleue) */
    .btn-retour {
      background-color: #3498db;
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: bold;
      transition: background-color 0.3s;
    }

    .btn-retour:hover {
      background-color: #2c80c4;
    }

    /* üîπ Bouton D√©connexion rouge */
    .btn-logout {
      background-color: #e74c3c;
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      text-decoration: none;
      font-weight: bold;
      transition: background-color 0.3s;
    }

    .btn-logout:hover {
      background-color: #c0392b;
    }

    .logo h1 {
      margin: 0;
      font-size: 1.3rem;
    }


    /* üîπ Bouton Enregistrer */
    .btn_valider {
      background-color: #27ae60;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s;
      margin-top: 15px;
    }

    .btn_valider:hover {
      background-color: #219150;
    }

  
  </style>
</head>

<body>
  <nav class="navbar">
    <div class="logo">
      <h1>Modification Sanction</h1>
    </div>
    <div class="nav-links">
      <ul>
        <!-- üîπ Bouton Retour bleu -->
        <li>
          <a href="persosanctiondetailparpersonne.html" class="btn-retour">
            <i class="fa-solid fa-arrow-left"></i> Retour
          </a>
        </li>

        <!-- Nom utilisateur -->
          <li class="Util2">
          <label style="color: white;">Utilisateur :</label>
          <span class="nom">---</span>
        </li>

        <!-- üîπ Bouton D√©connexion -->
        <li><a href="#" id="btn_quitter" class="btn-logout">D√©connexion</a></li>
      </ul>
    </div>
    <img src="../Image/menu_humberger.JPG" alt="menu" class="menu_humberger">
  </nav>

  <header>
    <div class="formulaire_saisie">
      <form id="postForm" class="detail">
        <div>
          <table>
            <tr>
              <td><label for="nom_personnel">Nom</label></td>
              <td>:</td>
              <td><input type="text" id="nom_personnel" readonly></td>
            </tr>
            <tr>
              <td><label for="prenom_personnel">Pr√©nom</label></td>
              <td>:</td>
              <td><input type="text" id="prenom_personnel" readonly></td>
            </tr>
            <tr>
              <td><label for="date_emission">Date d'√©mission</label></td>
              <td>:</td>
              <td><input type="date" id="date_emission" required></td>
            </tr>
            <tr>
              <td><label for="type">Type de sanction</label></td>
              <td>:</td>
              <td>
                <select id="type" required>
                  <option value="">-- S√©lectionner --</option>
                  <option value="1√®re avertissement verbal">1√®re avertissement verbal</option>
                  <option value="2√®me avertissement verbal">2√®me avertissement verbal</option>
                  <option value="1√®re avertissement √©crit">1√®re avertissement √©crit</option>
                  <option value="2√®me avertissement √©crit">2√®me avertissement √©crit</option>
                  <option value="3√®me avertissement √©crit">3√®me avertissement √©crit</option>
                </select>
              </td>
            </tr>
            <tr>
              <td><label for="motif">Motif :</label></td>
              <td>:</td>
              <td><textarea id="motif" rows="3" required></textarea></td>
            </tr>
          </table>
          <button type="submit" class="btn_valider">Enregistrer</button>
        </div>
      </form>
    </div>
  </header>

  <script>
    const SANCTION_API = "http://localhost:5000/api/sanctions";

    // üü¢ Afficher le nom utilisateur
    const nomUtilisateur = localStorage.getItem("nom_utilisateur");
    if (nomUtilisateur) {
      document.querySelector(".nom").textContent = nomUtilisateur;
    } else {
      window.location.href = "../index.html";
    }

    // üî¥ D√©connexion
    document.getElementById("btn_quitter").addEventListener("click", (e) => {
      e.preventDefault();
      localStorage.removeItem("nom_utilisateur");
      window.location.href = "../index.html";
    });

    // üîπ R√©cup√©ration des donn√©es de sanction
    const sanctionData = JSON.parse(localStorage.getItem("sanctionData"));
    if (!sanctionData) {
      alert("Aucune sanction s√©lectionn√©e !");
      window.location.href = "persosanctiondetailparpersonne.html";
    }

    // Pr√©-remplir le formulaire
    document.getElementById("nom_personnel").value = sanctionData.personnel.Nom;
    document.getElementById("prenom_personnel").value = sanctionData.personnel.Prenom;
    document.getElementById("type").value = sanctionData.sanction.Type_sanction;
    document.getElementById("motif").value = sanctionData.sanction.Motif;

    if (sanctionData.sanction.Date_emission) {
      const date = new Date(sanctionData.sanction.Date_emission);
      const yyyy = date.getFullYear();
      const mm = String(date.getMonth() + 1).padStart(2, '0');
      const dd = String(date.getDate()).padStart(2, '0');
      document.getElementById("date_emission").value = `${yyyy}-${mm}-${dd}`;
    }

    // üü¢ Soumission du formulaire
    document.getElementById("postForm").addEventListener("submit", function (e) {
      e.preventDefault();

      const updatedSanction = {
        Type_sanction: document.getElementById("type").value,
        Motif: document.getElementById("motif").value,
        Date_emission: document.getElementById("date_emission").value
      };

      fetch(`${SANCTION_API}/${sanctionData.sanction._id}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(updatedSanction)
      })
        .then(res => {
          if (res.ok) {
            alert("‚úÖ Sanction modifi√©e avec succ√®s !");
            localStorage.removeItem("sanctionData");
            window.location.href = "persosanctiondetailparpersonne.html";
          } else {
            alert("‚ùå Erreur lors de la modification !");
          }
        })
        .catch(err => {
          console.error("Erreur API PUT:", err);
          alert("‚ö†Ô∏è Erreur serveur !");
        });
    });
  </script>
</body>

</html>
